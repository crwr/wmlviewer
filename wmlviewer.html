<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>WaterML Viewer</title>

<!--General Style Sheets-->
	<link rel="stylesheet" href="wml.css">
    <style>
        .wmlMap, .wmlChart, .wmlTable{width: 100%;}
    </style>
    
<!--Mapping Scripts-->	
	<link rel="stylesheet" href="http://js.arcgis.com/3.9/js/esri/css/esri.css">
  	<script>var dojoConfig = { parseOnLoad:true };</script>
	<script src="http://js.arcgis.com/3.9compact/"></script>
    <script src="wml-map.js"></script>

<!--Charting scripts-->
    <!--Relative path to folder containing 'images' folder so wml-chart-templates.js can find icons used for buttons-->
    <script>var wmlviewerPath = '';</script>
	<script src="highcharts/jquery.1.9.1.min.js"></script>
	<script src="highcharts/highcharts.js"></script>
	<script src="highcharts/modules/exporting.js"></script>
	<script src="highcharts/modules/export-csv.js"></script>   
    <script src="wml-chart.js"></script> 
   	<script src="wml-property-library.js"></script>
   	<script src="wml-chart-templates.js"></script>    
    
</head>

<body>
	<div id="map" class="wmlMap"></div>
    <br/>
	<div id="chart" class="wmlChart"></div>
    <br/>
	<div id="table" class="wmlTable"></div>
    <br/>

<script>
	var mainMap = new WMLMap();
	mainMap.chartVariableName = "mainChart"; //This links the map to the chart and should match the chart variable defined below
	mainMap.mapDiv = "map";
	mainMap.init();
	
	var defaultService = "http://crwr-arcgis10.austin.utexas.edu/ArcGIS/rest/services/WorldWaterOnline/WatershedExplorer_Discharge/MapServer";
	
	//Allow user to specify a Feature Service as a URL parameter
	var featureService = GetSingleURLParameter();
	if (featureService == -1) {
		featureService = defaultService;
	}
	try {
		mainMap.AddFeatureService(featureService);
	} catch(err) {
		console.log("Invalid feature service provided in URL")
	}
	
	var mainChart = new WMLChart();
	mainChart.title = "WWO Stream Gages";
	mainChart.chartDiv = "chart";
	mainChart.tableDiv = "table";
	mainChart.init();	
	
function GetSingleURLParameter(){
	//This accepts a single Feature Service (which can be URL encoded or not) as an unnammed url parameter following the first "?" found in the url.
	//Allowing multiple parameters (would require a different approach.
	var url = document.URL;
	if ((url.indexOf("?")>0) && (url.length > url.indexOf("?")+1)) {
		var parameter = url.substring(url.indexOf("?")+1);	
		if (parameter.substr(parameter.length -1) == "#") {
			parameter = parameter.slice(0,-1);
		}
		return parameter;
	} else {
		return -1;
	}
}	
</script>

</body>

</html>
